<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Halaman Penjualan</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/person.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/table.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/form.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/penjualan.css}" />
</head>

<body>
    <!-- Navigation Menu -->
    <div style="background: #008081; padding: 15px; margin-bottom: 20px;">
        <a th:href="@{/person}" style="color: #D4AF37; margin: 0 15px; text-decoration: none; font-weight: 600;">Person</a>
        <a th:href="@{/buyer}" style="color: #D4AF37; margin: 0 15px; text-decoration: none; font-weight: 600;">Buyer</a>
        <a th:href="@{/seller}" style="color: #D4AF37; margin: 0 15px; text-decoration: none; font-weight: 600;">Seller</a>
        <a th:href="@{/produk}" style="color: #D4AF37; margin: 0 15px; text-decoration: none; font-weight: 600;">Produk</a>
        <a th:href="@{/penjualan}" style="color: #D4AF37; margin: 0 15px; text-decoration: none; font-weight: 600;">Penjualan</a>
        <a th:href="@{/sellerlogout}" style="color: #D4AF37; margin: 0 15px; text-decoration: none; float: right; font-weight: 600;">Logout</a>
    </div>

    <!-- ==================== BAGIAN TABEL ==================== -->
    <div class="first-box">
        <h2>Daftar Penjualan</h2>
        <table class="styled-table">
            <thead>
                <tr>
                    <th>No</th>
                    <th>Kode Penjualan</th>
                    <th>Buyer</th>
                    <th>Seller</th>
                    <th>Produk</th>
                    <th>Jumlah</th>
                    <th>Tanggal</th>
                    <th>Harga Jual</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="d, no : ${penjualanList}">
                    <td th:text="${no.count}"></td>
                    <td th:text="${d.saleID}"></td>
                    <td th:text="${d.buyer?.person?.name ?: 'N/A'}"></td>
                    <td th:text="${d.seller?.person?.name ?: 'N/A'}"></td>
                    <td th:text="${d.produk?.tipe ?: 'N/A'}"></td>
                    <td th:text="${d.jumlah}"></td>
                    <td th:text="${d.tanggal != null} ? ${#temporals.format(d.tanggal, 'dd MMM yyyy HH:mm')} : '-'"></td>
                    <td th:text="${d.hargaJual != null} ? 'Rp ' + ${#numbers.formatDecimal(d.hargaJual, 0, 'COMMA', 0, 'POINT')} : '-'"></td>
                    <td>
                        <a th:href="@{/penjualan/{id}(id=${d.saleID})}" class="btn-edit">Edit</a>
                        <a th:href="@{/penjualan/delete/{id}(id=${d.saleID})}" class="btn-delete" onclick="return confirm('Hapus penjualan?')">Hapus</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- ==================== BAGIAN FORM ==================== -->
    <div class="second-box">
        <div id="feedback-form">
            <h2 class="header" th:text="${penjualan.saleID != null} ? 'Edit Penjualan' : 'Tambah Penjualan'"></h2>

            <form th:action="@{/penjualan/submit}" method="post" th:object="${penjualan}">
                
                <input type="hidden" th:field="*{saleID}" />

                <label for="buyerId" class="form-label">Buyer</label>
                <select id="buyerId" name="buyerId" required>
                    <option value="">-- Pilih Buyer --</option>
                    <option th:each="b : ${buyerList}"
                            th:value="${b.id}"
                            th:text="${b.person.name + ' - ' + b.alamat}"
                            th:selected="${penjualan.buyer != null} ? (${b.id} == ${penjualan.buyer.id}) : false">
                    </option>
                </select>

                <label for="sellerId" class="form-label">Seller</label>
                <select id="sellerId" name="sellerId" required>
                    <option value="">-- Pilih Seller --</option>
                    <option th:each="s : ${sellerList}"
                            th:value="${s.id}"
                            th:text="${s.person.name}"
                            th:selected="${penjualan.seller != null} ? (${s.id} == ${penjualan.seller.id}) : false">
                    </option>
                </select>

                <label for="produkId" class="form-label">Produk</label>
                <select id="produkId" name="produkId" required>
                    <option value="">-- Pilih Produk --</option>
                    <option th:each="p : ${produkList}"
                            th:value="${p.id}"
                            th:text="${p.tipe + ' / ' + p.produsen + ' (RAM: ' + p.ram + 'GB)'}"
                            th:selected="${penjualan.produk != null} ? (${p.id} == ${penjualan.produk.id}) : false">
                    </option>
                </select>

                <label for="jumlah" class="form-label">Jumlah Barang</label>
                <input type="number" id="jumlah" th:field="*{jumlah}" min="1" required />

                <label for="tanggal" class="form-label">Tanggal Transaksi</label>
                <input type="datetime-local" id="tanggal" th:field="*{tanggal}" required />

                <label for="hargaJual" class="form-label">Harga Jual</label>
                <input type="number" id="hargaJual" th:field="*{hargaJual}" min="0" required />

                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">
                        <span th:text="${penjualan.saleID != null} ? 'Update' : 'Simpan'"></span>
                    </button>
            </form>
        </div>
    </div>

</body>
</html>